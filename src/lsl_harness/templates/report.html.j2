<!doctype html>
<meta charset="utf-8">
<title>LSL Harness Report</title>
<h1>LSL Harness Report</h1>

<h2>Metrics Summary</h2>
<table border="1" cellspacing="0" cellpadding="4">
  <tr><th colspan="2">Latency</th></tr>
  <tr><td>p50</td><td>{{ p50_ms | round(2) }} ms</td></tr>
  <tr><td>p95</td><td>{{ p95_ms | round(2) }} ms</td></tr>
  <tr><td>p99</td><td>{{ p99_ms | round(2) }} ms</td></tr>
  <tr><td>Max</td><td>{{ max_latency_ms | round(2) }} ms</td></tr>

  <tr><th colspan="2">Variability</th></tr>
  <tr><td>Jitter (p95-p50)</td><td>{{ jitter_ms | round(2) }} ms</td></tr>
  <tr><td>Jitter std</td><td>{{ jitter_std | round(2) }} ms</td></tr>

  <tr><th colspan="2">Rate & Loss</th></tr>
  <tr><td>Effective Hz</td><td>{{ effective_sample_rate_hz | round(2) }}</td></tr>
  <tr><td>Drop estimate</td><td>{{ drops_percentage | round(2) }} %</td></tr>
  <tr><td>Total samples</td><td>{{ total_sample_count }}</td></tr>
  <tr><td>Ring drops</td><td>{{ ring_drops }}</td></tr>

  <tr><th colspan="2">Source Timing (ISI)</th></tr>
  <tr><td>ISI mean</td><td>{{ isi_mean_ms | round(2) }} ms</td></tr>
  <tr><td>ISI std</td><td>{{ isi_std_ms | round(2) }} ms</td></tr>
  <tr><td>ISI p50</td><td>{{ isi_p50_ms | round(2) }} ms</td></tr>
  <tr><td>ISI p95</td><td>{{ isi_p95_ms | round(2) }} ms</td></tr>
  <tr><td>ISI p99</td><td>{{ isi_p99_ms | round(2) }} ms</td></tr>

  <tr><th colspan="2">Receive Intervals (R-R)</th></tr>
  <tr><td>R-R mean</td><td>{{ rr_mean_ms | round(2) }} ms</td></tr>
  <tr><td>R-R std</td><td>{{ rr_std_ms | round(2) }} ms</td></tr>

  <tr><th colspan="2">Clock</th></tr>
  <tr><td>Drift</td><td>{{ drift_ms_per_min | round(2) }} ms/min</td></tr>

  <tr><th colspan="2">Sequence</th></tr>
  <tr><td>Discontinuities</td><td>{{ sequence_discontinuities }}</td></tr>
</table>

<h2>Plots</h2>
<div>
  <figure>
    <img src="latency_hist.png" alt="Latency histogram" style="max-width: 600px; width: 100%; height: auto;">
    <figcaption>Latency histogram (ms)</figcaption>
  </figure>
  {% if drift_plot %}
  <figure>
    <img src="drift_plot.png" alt="Offset vs Time (drift)" style="max-width: 600px; width: 100%; height: auto;">
    <figcaption>Offset vs Time (drift)</figcaption>
  </figure>
  {% endif %}
  </div>

<h2>Run Parameters</h2>
<ul>
  <li>Selector: {{ parameters.selector.key }}={{ parameters.selector.value }}</li>
  <li>Duration (s): {{ parameters.duration_seconds }}</li>
  <li>Chunk size: {{ parameters.chunk_size }}</li>
  <li>Nominal sample rate (Hz): {{ parameters.nominal_sample_rate }}</li>
  <li>Python: {{ environment.python }}</li>
  <li>Platform: {{ environment.platform }}</li>
  <li>pylsl: {{ environment.pylsl_version }}</li>
  </ul>

<details>
  <summary>Raw environment JSON</summary>
  <pre>{{ environment|tojson(indent=2) }}</pre>
  <pre>{{ parameters|tojson(indent=2) }}</pre>
</details>